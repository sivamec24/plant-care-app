{% extends "base.html" %}

{% block title %}Users - Admin{% endblock %}
{% block description %}Manage and view user accounts.{% endblock %}

{% block robots %}<meta name="robots" content="noindex, nofollow">{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
  <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-2">
    <a href="{{ url_for('admin.index') }}" class="hover:text-emerald-600 dark:hover:text-emerald-400">Admin</a>
    <span>/</span>
    <span>Users</span>
  </div>
  <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 dark:text-slate-100 mb-2">
    User Management
  </h1>
  <p class="text-lg text-slate-600 dark:text-slate-400">
    {{ total }} total users
  </p>
</div>

<!-- Search Bar -->
<div class="card mb-6">
  <form method="get" action="{{ url_for('admin.users') }}" class="flex gap-4">
    <div class="flex-1">
      <input
        type="text"
        name="search"
        value="{{ search }}"
        placeholder="Search by email..."
        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
      >
    </div>
    <button type="submit" class="btn btn-primary">
      Search
    </button>
    {% if search %}
    <a href="{{ url_for('admin.users') }}" class="btn btn-secondary">
      Clear
    </a>
    {% endif %}
  </form>
</div>

{% if error %}
<div class="card mb-6 border-l-4 border-amber-500">
  <p class="text-amber-700 dark:text-amber-400">{{ error }}</p>
</div>
{% endif %}

<!-- Users Table -->
<div class="card overflow-hidden">
  {% if users %}
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 dark:bg-slate-800/50">
        <tr>
          <th class="px-4 py-3 text-left text-sm font-semibold text-slate-900 dark:text-slate-100">Email</th>
          <th class="px-4 py-3 text-left text-sm font-semibold text-slate-900 dark:text-slate-100">Signed Up</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-slate-900 dark:text-slate-100">Plants</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-slate-900 dark:text-slate-100">Reminders</th>
          <th class="px-4 py-3 text-right text-sm font-semibold text-slate-900 dark:text-slate-100">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
        {% for user in users %}
        <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/30">
          <td class="px-4 py-3">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-slate-900 dark:text-slate-100">{{ user.email }}</span>
              {% if user.is_admin %}
              <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300">Admin</span>
              {% endif %}
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-400">{{ user.id[:8] }}...</div>
          </td>
          <td class="px-4 py-3 text-sm text-slate-600 dark:text-slate-400">
            {{ user.created_at[:10] if user.created_at else 'Unknown' }}
          </td>
          <td class="px-4 py-3 text-center">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300">
              {{ user.plant_count or 0 }}
            </span>
          </td>
          <td class="px-4 py-3 text-center">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300">
              {{ user.reminder_count or 0 }}
            </span>
          </td>
          <td class="px-4 py-3 text-right">
            <a href="{{ url_for('admin.user_detail', user_id=user.id) }}" class="text-sm text-emerald-600 dark:text-emerald-400 hover:underline">
              View Details
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if total_pages > 1 %}
  <div class="flex items-center justify-between px-4 py-3 border-t border-slate-200 dark:border-slate-700">
    <div class="text-sm text-slate-600 dark:text-slate-400">
      Page {{ page }} of {{ total_pages }}
    </div>
    <div class="flex gap-2">
      {% if page > 1 %}
      <a href="{{ url_for('admin.users', page=page-1, search=search) }}" class="btn btn-secondary text-sm py-1 px-3">
        Previous
      </a>
      {% endif %}
      {% if page < total_pages %}
      <a href="{{ url_for('admin.users', page=page+1, search=search) }}" class="btn btn-secondary text-sm py-1 px-3">
        Next
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}

  {% else %}
  <p class="text-slate-500 dark:text-slate-400 text-center py-8">
    {% if search %}No users found matching "{{ search }}"{% else %}No users found{% endif %}
  </p>
  {% endif %}
</div>

<!-- Back Navigation -->
<div class="mt-8">
  <a href="{{ url_for('admin.index') }}" class="btn btn-secondary">
    &larr; Back to Admin Dashboard
  </a>
</div>

{% endblock %}
